Recordings
============

[[Parent]]: ds.txt

Each _recording_ is uniquely identified by its recording ID (`$RECID`).
The recording ID must be a string with 4 lowercase alphanumeric characters. 
Within a recording, each subject is identified by a 4 digits numeric code 
(`$SUBJID`), i.e. 0001, 0002, etc. Each recording modality has a unique code
(`$MODID`). In the current version, the SOMSDS scripts do not impose 
restrictions on `$RECID`, apart from requiring it to be a valid directory
name. However, it is strongly recommended that _project_ and _recording_ IDs are 
combinations of 4 lowercase alphanumeric characters. 

The user does not have to worry about the `$SUBJID`, as these are
automatically generated when adding new subjects to a recording. On the other
hand, `$MODID` must be one of the standard modality names accepted by the
SOMSDS scripts, e.g. eeg, meg, fmri, smri, actigraphy, etc. Valid modalities
are listed in an internal configuration file ([SOMSDS.ini][somsdsini]) and can 
be displayed by running the following command:

	somsds_get modality

which should return something like what is shown below:

	Valid modality values
	-------------------

	+-------------+---------------------------+----------------------------+
	| modality    | description               | ext                        |
	+-------------+---------------------------+----------------------------+
	| eeg         | Electroencephalography    | .edf .raw .mat .eeg .dat   |
	| meg         | Magnetoencephalography    | .fif .mat                  |
	| smri        | Structural MRI            | .nii .nii.gz .gz .img .hdr |
	| fmri        | Functional MRI            | .nii .nii.gz .gz .hdr .img |
	| behavior    | Behavioral data           | .txt .mat                  |
	| actigraphy  | Actigraphy                | .mat .bin .AWD             |
	| temperature | Temperature measurements  | .mat                       |
	| physiology  | Physiological time-series | .log                       |
	| annotation  | Annotations               |                            |
	+-------------+---------------------------+----------------------------+



If the modality that you are planning to acquire is not listed in the table 
above, you should contanct an administrator of somerenserver so that he/she adds
the new modality in file [SOMSDS.ini][somsdsini].


[somsdsini]: ./SOMSDS/lib/SOMSDS.ini.htm



Raw data files
--------

### New experimental data

When acquiring new experimental data, you should always place (either manually 
or using the SOMSDS scripts) all the original recording files in one of the 
following locations:

	$RECORDINGS/$RECNAME/subjects/$SUBJID/$MODID/orig
	$RECORDINGS/$RECNAME/subjects/$SUBJID/$MODID/conv

The files stored in the above locations will have their original names (given
by the recording device) and might be organized into an arbitrary number
of sub-folders. For instance different sub-folders might be used for storing
data files from different conditions or different recording sessions. The 
specific organization of these two folders is probably irrelevant as 
you should not access files from these locations to perform any analysis. 

In any case, it is recommended for the `orig` folder to contain only raw data 
(directly coming from the recording device) and for the `conv` folder to contain 
the result of converting the original data into a different data format. For 
instance you might place `.PAR/.REC` files in the `orig` folder and the converted 
`.nii.gz` files in the `conv` folder. If the data conversion was performed by 
the recording device (e.g. most scanners allow exporting the data in multiple 
formats), it is acceptable to place both the `.PAR/.REC` and `.nii.gz` files in
the `orig` folder.


### Old experimental data

When the data of a given recording was originally stored using a non-standard
directory structure, the `orig` and `conv` folders above might not be used.
Instead, the original data structure could be stored in:

	$RECORDINGS/$RECNAME/imported/[import_conf]_YYYY-MM-DD_hh-mm-ss/

where `YYYY-MM-DD_hh-mm-ss` is the date and time when the original data was 
_imported_ (using the script [somsds_import_rec][importrec]). The prefix 
`[import_conf]` is the name of the _import configuration file_ that was used in
combination with [somsds_import_rec][importrec].

[importrec]: ./howto_import_data.htm

In general, if you need to import old data, it is best that you ask for help
from an administrator.


Interface
--------

When performing an analysis on a specific recording, you should always
access data files from the following location:

	$RECORDINGS/$RECNAME/subjects/$SUBJID/$MODID/raw
	
The files within the `raw` folder above comply with the following naming
convention:

	$RECID_$SUJID_$MODID_$DEVICEID_$TECID_$CONDID_$SESSION_$BLOCK<.ext>

where the file extension `<.ext>` will be one of the file extensions accepted
for the corresponding modality. For instance, the valid file extensions
for structural MRI scans (`smri` modality) are `.nii` and `nii.gz`. The 
_fields_ `$DEVICEID`, `$TECID`, `$CONDID`, `$SESSION` and `$BLOCK` might be
absent if they are not relevant for a given file. Below you can find a list of
sample file names that follow this naming convention:

	ssea_001_eeg_rs-eo_1.edf
	ssea_001_smri_t1.nii.gz

Note that _fields_ in the standard file names are separated by underscores, 
which implies that you cannot use underscores within a field. To represent
spaces or subfields within a field use hyphens. 

Although there are no standard condition names you are encouranged to re-use 
condition names as much as possible. To get a list of commonly used (easily 
resusable) conditions names run the command:

	somsds_get condition

which should display something like this:

	Valid condition values
	-------------------

	+-----------+---------------------------+
	| condition | description               |
	+-----------+---------------------------+
	| rs-ec     | Resting state eyes closed |
	| rs-eo     | Resting state eyes open   |
	| sleep     | Sleep                     |
	+-----------+---------------------------+

It is also recommended to separate sub-conditions using hyphens and to use only
lowercase in condition IDs (and also in other field values, e.g. in the 
recording ID).

The files within the `raw` folder are not hard copies of the original 
files in `orig` or `conv` but symbolic links to those files. 

